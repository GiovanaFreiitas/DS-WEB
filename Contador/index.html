<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paneinel de Senha</title>
  <link rel="stylesheet" href="style.css">
  
</head>
<body>
  <h1>CONSULTÓRIO 1</h1>
  <br>
  <h3>SENHA:</h3>
  <div id="contador" class="contador">0</div>
  <button id="conectar">Conectar ao Arduino</button>

  <script>
    let numero = 0;
    const contador = document.getElementById("contador");
    const botaoConectar = document.getElementById("conectar");

    function atualizar() {
      contador.textContent = numero;
      contador.style.color = numero > 0 ? "#4a4cde" : numero < 0 ? "#f87171" : "#fff";
    }

    async function conectarArduino() {
      try {
      
        const porta = await navigator.serial.requestPort();
        await porta.open({ baudRate: 9600 });
        botaoConectar.textContent = "Conectado ✅";

        
        const decoder = new TextDecoderStream();
        porta.readable.pipeTo(decoder.writable);
        const leitor = decoder.readable
          .pipeThrough(new TransformStream(new LineBreakTransformer()))
          .getReader();

        while (true) {
          const { value, done } = await leitor.read();
          if (done) break;
          if (!value) continue;

          if (value.includes("AUMENTAR")) {
            numero++;
            atualizar();
          } else if (value.includes("DIMINUIR")) {
            numero--;
            atualizar();
          }
        }

        leitor.releaseLock();
      } catch (e) {
        alert("Erro ao conectar: " + e);
      }
    }

    class LineBreakTransformer {
      constructor() {
        this.chunks = "";
      }
      transform(chunk, controller) {
        this.chunks += chunk;
        const linhas = this.chunks.split("\n");
        this.chunks = linhas.pop();
        linhas.forEach((linha) => controller.enqueue(linha.trim()));
      }
      flush(controller) {
        controller.enqueue(this.chunks.trim());
      }
    }

    botaoConectar.addEventListener("click", conectarArduino);
  </script>
</body>
</html>

